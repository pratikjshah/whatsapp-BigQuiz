{"ast":null,"code":"import _slicedToArray from \"/Users/p0s00zi/__personal/extra/whatsapp-BigQuiz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/p0s00zi/__personal/extra/whatsapp-BigQuiz/src/__uploader.js\";\nimport React, { useState, useRef, useEffect } from 'react';\nimport JSZip from 'jszip'; //import fs from 'fs';\n\nimport { parseString } from 'whatsapp-chat-parser';\nimport Dropzone from './components/Dropzone/Dropzone';\nimport MessageViewer from './components/MessageViewer/MessageViewer';\nimport Credits from './components/Credits/Credits';\nimport * as S from './style';\nimport useDebounce from './hooks/useDebounce';\nimport exampleChat from './assets/whatsapp-chat-example.zip'; //import initialChat from './assets/_chat.txt';\n\nconst showError = (message, err) => {\n  console.error(err || message); // eslint-disable-line no-console\n\n  alert(message); // eslint-disable-line no-alert\n};\n\nconst App = () => {\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        messages = _useState2[0],\n        setMessages = _useState2[1];\n\n  const _useState3 = useState(5000),\n        _useState4 = _slicedToArray(_useState3, 2),\n        messagesLimit = _useState4[0],\n        setMessagesLimit = _useState4[1];\n\n  const _useState5 = useState(false),\n        _useState6 = _slicedToArray(_useState5, 2),\n        isMenuOpen = _useState6[0],\n        setIsMenuOpen = _useState6[1];\n\n  const closeButtonRef = useRef(null);\n  const openButtonRef = useRef(null);\n  const isFirstRender = useRef(true); //const fileContents = fs.readFileSync({initialChat}, 'utf8');\n\n  const closeMenu = () => {\n    setIsMenuOpen(false);\n  };\n\n  const openMenu = () => {\n    setIsMenuOpen(true);\n  };\n\n  const loginconsole = file => {\n    console.log('msg: ' + file);\n  };\n\n  function saveParsedMessages(messages) {\n    console.log(messages.length);\n    console.log(messages);\n    var data = \"text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(messages));\n    exportDataToFile(data);\n    invokeSaveAsDialog();\n  }\n\n  function exportDataToFile(data) {}\n  /**\n  * @param {Blob} file - File or Blob object. This parameter is required.\n  * @param {string} fileName - Optional file name e.g. \"image.png\"\n  */\n\n\n  function invokeSaveAsDialog(file, fileName) {\n    if (!file) {\n      throw 'Blob object is required.';\n    }\n\n    if (!file.type) {\n      try {\n        file.type = 'video/webm';\n      } catch (e) {}\n    }\n\n    var fileExtension = (file.type || 'video/webm').split('/')[1];\n\n    if (fileName && fileName.indexOf('.') !== -1) {\n      var splitted = fileName.split('.');\n      fileName = splitted[0];\n      fileExtension = splitted[1];\n    }\n\n    var fileFullName = (fileName || Math.round(Math.random() * 9999999999) + 888888888) + '.' + fileExtension;\n\n    if (typeof navigator.msSaveOrOpenBlob !== 'undefined') {\n      return navigator.msSaveOrOpenBlob(file, fileFullName);\n    } else if (typeof navigator.msSaveBlob !== 'undefined') {\n      return navigator.msSaveBlob(file, fileFullName);\n    }\n\n    var hyperlink = document.createElement('a');\n    hyperlink.href = URL.createObjectURL(file);\n    hyperlink.download = fileFullName;\n    hyperlink.style = 'display:none;opacity:0;color:transparent;';\n    (document.body || document.documentElement).appendChild(hyperlink);\n\n    if (typeof hyperlink.click === 'function') {\n      hyperlink.click();\n    } else {\n      hyperlink.target = '_blank';\n      hyperlink.dispatchEvent(new MouseEvent('click', {\n        view: window,\n        bubbles: true,\n        cancelable: true\n      }));\n    }\n\n    (window.URL || window.webkitURL).revokeObjectURL(hyperlink.href);\n  }\n\n  const processFile = file => {\n    loginconsole(file);\n    if (!file) return;\n    const reader = new FileReader();\n\n    if (file.type === 'application/zip') {\n      reader.onloadend = e => {\n        const arrayBuffer = e.target.result;\n        const jszip = new JSZip();\n        jszip.loadAsync(arrayBuffer).then(({\n          files\n        }) => {\n          const txtFiles = Object.entries(files).filter(([fileName]) => fileName.endsWith('.txt'));\n\n          if (!txtFiles.length) {\n            throw new Error('No txt files found in archive');\n          }\n\n          return txtFiles.sort(([a], [b]) => a.length - b.length)[0][1].async('string');\n        }).then(parseString).then(setMessages).catch(showError);\n      };\n\n      reader.readAsArrayBuffer(file);\n    } else if (file.type === 'text/plain') {\n      reader.onloadend = () => parseString(reader.result) //.then(setMessages)\n      .then(messages => {\n        saveParsedMessages(messages);\n      }).catch(err => showError('An error has occurred while parsing the file', err));\n\n      reader.readAsText(file);\n    } else {\n      showError(\"File type \".concat(file.type, \" not supported\"));\n    }\n  };\n\n  useEffect(() => {\n    if (isFirstRender.current) {\n      //processFile({fileContents});\n      //console.log('initialChat: ' + {initialChat});\n      return;\n    }\n\n    if (isMenuOpen) closeButtonRef.current.focus();else openButtonRef.current.focus();\n  }, [isMenuOpen]);\n  useEffect(() => {\n    isFirstRender.current = false;\n  }, []);\n  useEffect(() => {\n    const keyDownHandler = e => {\n      if (e.keyCode === 27) closeMenu();\n    };\n\n    document.addEventListener('keydown', keyDownHandler);\n    return () => document.removeEventListener('keydown', keyDownHandler);\n  }, []);\n  return React.createElement(React.Fragment, null, React.createElement(S.GlobalStyles, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187\n    },\n    __self: this\n  }), React.createElement(S.Container, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, React.createElement(S.Header, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }, React.createElement(Dropzone, {\n    onFileUpload: processFile,\n    id: \"dropzone\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }), React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, \"OR\"), React.createElement(\"a\", {\n    href: exampleChat,\n    download: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }, \"Download example chat\")), React.createElement(MessageViewer, {\n    messages: messages,\n    limit: useDebounce(messagesLimit, 5000),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  }), React.createElement(S.MenuOpenButton, {\n    type: \"button\",\n    onClick: openMenu,\n    ref: openButtonRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }, \"Open menu\"), React.createElement(S.Overlay, {\n    type: \"button\",\n    isActive: isMenuOpen,\n    onClick: closeMenu,\n    tabIndex: \"-1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203\n    },\n    __self: this\n  }), React.createElement(S.Sidebar, {\n    isOpen: isMenuOpen,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209\n    },\n    __self: this\n  }, React.createElement(S.MenuCloseButton, {\n    type: \"button\",\n    onClick: closeMenu,\n    ref: closeButtonRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210\n    },\n    __self: this\n  }, \"Close menu\"), React.createElement(S.SidebarContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217\n    },\n    __self: this\n  }, React.createElement(S.Field, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218\n    },\n    __self: this\n  }, React.createElement(S.Label, {\n    htmlFor: \"limit\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219\n    },\n    __self: this\n  }, \"Messages limit\"), React.createElement(S.Input, {\n    id: \"limit\",\n    type: \"number\",\n    min: \"0\",\n    max: messages.length,\n    value: messagesLimit,\n    onChange: e => setMessagesLimit(parseInt(e.currentTarget.value, 10)),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220\n    },\n    __self: this\n  }), React.createElement(S.InputDescription, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }, \"A high number may freeze the page for a while, change this with caution\")), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236\n    },\n    __self: this\n  }, React.createElement(Credits, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237\n    },\n    __self: this\n  }))))));\n};\n\nexport default App;","map":{"version":3,"sources":["/Users/p0s00zi/__personal/extra/whatsapp-BigQuiz/src/__uploader.js"],"names":["React","useState","useRef","useEffect","JSZip","parseString","Dropzone","MessageViewer","Credits","S","useDebounce","exampleChat","showError","message","err","console","error","alert","App","messages","setMessages","messagesLimit","setMessagesLimit","isMenuOpen","setIsMenuOpen","closeButtonRef","openButtonRef","isFirstRender","closeMenu","openMenu","loginconsole","file","log","saveParsedMessages","length","data","encodeURIComponent","JSON","stringify","exportDataToFile","invokeSaveAsDialog","fileName","type","e","fileExtension","split","indexOf","splitted","fileFullName","Math","round","random","navigator","msSaveOrOpenBlob","msSaveBlob","hyperlink","document","createElement","href","URL","createObjectURL","download","style","body","documentElement","appendChild","click","target","dispatchEvent","MouseEvent","view","window","bubbles","cancelable","webkitURL","revokeObjectURL","processFile","reader","FileReader","onloadend","arrayBuffer","result","jszip","loadAsync","then","files","txtFiles","Object","entries","filter","endsWith","Error","sort","a","b","async","catch","readAsArrayBuffer","readAsText","current","focus","keyDownHandler","keyCode","addEventListener","removeEventListener","parseInt","currentTarget","value"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport JSZip from 'jszip';\n//import fs from 'fs';\nimport { parseString } from 'whatsapp-chat-parser';\n\nimport Dropzone from './components/Dropzone/Dropzone';\nimport MessageViewer from './components/MessageViewer/MessageViewer';\nimport Credits from './components/Credits/Credits';\nimport * as S from './style';\n\nimport useDebounce from './hooks/useDebounce';\n\nimport exampleChat from './assets/whatsapp-chat-example.zip';\n//import initialChat from './assets/_chat.txt';\n\nconst showError = (message, err) => {\n  console.error(err || message); // eslint-disable-line no-console\n  alert(message); // eslint-disable-line no-alert\n};\n\nconst App = () => {\n  const [messages, setMessages] = useState([]);\n  const [messagesLimit, setMessagesLimit] = useState(5000);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const closeButtonRef = useRef(null);\n  const openButtonRef = useRef(null);\n  const isFirstRender = useRef(true);\n\n  //const fileContents = fs.readFileSync({initialChat}, 'utf8');\n\n  const closeMenu = () => {\n    setIsMenuOpen(false);\n  };\n\n  const openMenu = () => {\n    setIsMenuOpen(true);\n  };\n\n  const loginconsole = file => {\n    console.log('msg: ' + file);\n  };\n\n  function saveParsedMessages(messages) {\n  \tconsole.log(messages.length);\n  \tconsole.log(messages);\n\n\n  \tvar data = \"text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(messages));\n  \texportDataToFile(data);\n\n  \tinvokeSaveAsDialog();\n\n  }\n\n  function exportDataToFile(data) {\n\n  }\n\n\t/**\n\t* @param {Blob} file - File or Blob object. This parameter is required.\n\t* @param {string} fileName - Optional file name e.g. \"image.png\"\n\t*/\n\tfunction invokeSaveAsDialog(file, fileName) {\n\t    if (!file) {\n\t        throw 'Blob object is required.';\n\t    }\n\n\t    if (!file.type) {\n\t        try {\n\t            file.type = 'video/webm';\n\t        } catch (e) {}\n\t    }\n\n\t    var fileExtension = (file.type || 'video/webm').split('/')[1];\n\n\t    if (fileName && fileName.indexOf('.') !== -1) {\n\t        var splitted = fileName.split('.');\n\t        fileName = splitted[0];\n\t        fileExtension = splitted[1];\n\t    }\n\n\t    var fileFullName = (fileName || (Math.round(Math.random() * 9999999999) + 888888888)) + '.' + fileExtension;\n\n\t    if (typeof navigator.msSaveOrOpenBlob !== 'undefined') {\n\t        return navigator.msSaveOrOpenBlob(file, fileFullName);\n\t    } else if (typeof navigator.msSaveBlob !== 'undefined') {\n\t        return navigator.msSaveBlob(file, fileFullName);\n\t    }\n\n\t    var hyperlink = document.createElement('a');\n\t    hyperlink.href = URL.createObjectURL(file);\n\t    hyperlink.download = fileFullName;\n\n\t    hyperlink.style = 'display:none;opacity:0;color:transparent;';\n\t    (document.body || document.documentElement).appendChild(hyperlink);\n\n\t    if (typeof hyperlink.click === 'function') {\n\t        hyperlink.click();\n\t    } else {\n\t        hyperlink.target = '_blank';\n\t        hyperlink.dispatchEvent(new MouseEvent('click', {\n\t            view: window,\n\t            bubbles: true,\n\t            cancelable: true\n\t        }));\n\t    }\n\n\t    (window.URL || window.webkitURL).revokeObjectURL(hyperlink.href);\n\t}\n\n  const processFile = file => {\n    loginconsole(file);\n\n    if (!file) return;\n\n    const reader = new FileReader();\n\n    if (file.type === 'application/zip') {\n      reader.onloadend = e => {\n        const arrayBuffer = e.target.result;\n        const jszip = new JSZip();\n\n        jszip\n          .loadAsync(arrayBuffer)\n          .then(({ files }) => {\n            const txtFiles = Object.entries(files).filter(([fileName]) =>\n              fileName.endsWith('.txt'),\n            );\n\n            if (!txtFiles.length) {\n              throw new Error('No txt files found in archive');\n            }\n\n            return txtFiles\n              .sort(([a], [b]) => a.length - b.length)[0][1]\n              .async('string');\n          })\n          .then(parseString)\n          .then(setMessages)  \n          .catch(showError);\n      };\n      reader.readAsArrayBuffer(file);\n    } else if (file.type === 'text/plain') {\n      reader.onloadend = () =>\n        parseString(reader.result)\n          //.then(setMessages)\n          .then( messages => {\n          \tsaveParsedMessages(messages);\n          })\n          .catch(err =>\n            showError('An error has occurred while parsing the file', err),\n          );\n      reader.readAsText(file);\n    } else {\n      showError(`File type ${file.type} not supported`);\n    }\n  };\n\n  useEffect(() => {\n    if (isFirstRender.current) {\n      //processFile({fileContents});\n      //console.log('initialChat: ' + {initialChat});\n\n      return;\n    }\n\n    if (isMenuOpen) closeButtonRef.current.focus();\n    else openButtonRef.current.focus();\n  }, [isMenuOpen]);\n\n  useEffect(() => {\n    isFirstRender.current = false;\n  }, []);\n\n  useEffect(() => {\n    const keyDownHandler = e => {\n      if (e.keyCode === 27) closeMenu();\n    };\n\n    document.addEventListener('keydown', keyDownHandler);\n    return () => document.removeEventListener('keydown', keyDownHandler);\n  }, []);\n\n  return (\n    <>\n      <S.GlobalStyles />\n      <S.Container>\n        <S.Header>\n          <Dropzone onFileUpload={processFile} id=\"dropzone\" />\n          <span>OR</span>\n          <a href={exampleChat} download>\n            Download example chat\n          </a>\n        </S.Header>\n        <MessageViewer\n          messages={messages}\n          limit={useDebounce(messagesLimit, 5000)}\n        />\n        <S.MenuOpenButton type=\"button\" onClick={openMenu} ref={openButtonRef}>\n          Open menu\n        </S.MenuOpenButton>\n        <S.Overlay\n          type=\"button\"\n          isActive={isMenuOpen}\n          onClick={closeMenu}\n          tabIndex=\"-1\"\n        />\n        <S.Sidebar isOpen={isMenuOpen}>\n          <S.MenuCloseButton\n            type=\"button\"\n            onClick={closeMenu}\n            ref={closeButtonRef}\n          >\n            Close menu\n          </S.MenuCloseButton>\n          <S.SidebarContainer>\n            <S.Field>\n              <S.Label htmlFor=\"limit\">Messages limit</S.Label>\n              <S.Input\n                id=\"limit\"\n                type=\"number\"\n                min=\"0\"\n                max={messages.length}\n                value={messagesLimit}\n                onChange={e =>\n                  setMessagesLimit(parseInt(e.currentTarget.value, 10))\n                }\n              />\n              <S.InputDescription>\n                A high number may freeze the page for a while, change this with\n                caution\n              </S.InputDescription>\n            </S.Field>\n\n            <div>\n              <Credits />\n            </div>\n          </S.SidebarContainer>\n        </S.Sidebar>\n      </S.Container>\n    </>\n  );\n};\n\nexport default App;"]},"metadata":{},"sourceType":"module"}